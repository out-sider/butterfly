<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>butterfly.runmanager API documentation</title>
    <meta name="description" content="Runmanager for butterfly.

Run manager is only useful for running OpenFOAM for Windows which runs in..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>

  <!-- highlight.js for highlighting source code. -->
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/default.min.css">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js"></script>

  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 0.9em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    margin-left: 25%;
    max-width: 90%;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    position: fixed;
    height: 100%;
    width: 25%;
    float: left;
    padding: 30px;
    overflow-x: hidden;
    overflow-y: auto;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: auto;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }

  .desc {
    white-space: pre-wrap;
  }

  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
        position: inherit;
        float: none;
        width: auto;
    }
    #content {
      width: 95%;
      margin-left: auto;
      border-left: none;
      padding: 30px;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>


  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#butterfly.runmanager.PIPE">PIPE</a></li>
  </ul>

    </li>


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#butterfly.runmanager.RunManager">RunManager</a></span>
        
          
  <ul>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.__init__">__init__</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.ToString">ToString</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.checkFileContents">checkFileContents</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.command">command</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.duplicate">duplicate</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.getContainerId">getContainerId</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.getPid">getPid</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.getShellinit">getShellinit</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.header">header</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.run">run</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.startOpenFOAM">startOpenFOAM</a></li>
    <li class="mono"><a href="#butterfly.runmanager.RunManager.terminate">terminate</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#butterfly.runmanager.UserNotAdminError">UserNotAdminError</a></span>
        
        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">butterfly.runmanager</span> module</h1>
  <p>Runmanager for butterfly.</p>
<p>Run manager is only useful for running OpenFOAM for Windows which runs in a
docker container. For linux systems simply use .bash files or libraries such as
pyFOAM.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager" class="source">
    <pre><code># coding=utf-8
"""Runmanager for butterfly.

Run manager is only useful for running OpenFOAM for Windows which runs in a
docker container. For linux systems simply use .bash files or libraries such as
pyFOAM.
"""
import os
import ctypes
import time
import sys
from subprocess import PIPE, Popen
from collections import namedtuple
from copy import deepcopy

from .version import Version


class UserNotAdminError(Exception):
    """Exception for non-admin users."""
    pass


class RunManager(object):
    """RunManager to write and run OpenFOAM commands through batch files.

    Run manager is currently only useful for running OpenFOAM for Windows which
    runs in a docker container. For linux systems simply use .bash files or
    libraries such as pyFOAM.

    """

    shellinit = None
    __containerId = None

    def __init__(self, projectName):
        u"""Init run manager for project.

        Project path will be set to: C:/Users/%USERNAME%/butterfly/projectName

        Args:
            projectName: A string for project name.
        """
        assert os.name == 'nt', "Currently RunManager is only supported on Windows."
        # make sure user has admin rights
        if not ctypes.windll.shell32.IsUserAnAdmin():
            raise UserNotAdminError(
                'In order to run OpenFOAM using butterfly you must use an admin '
                'account or run the program as administrator.')

        self.__projectName = projectName
        self.__separator = '&'
        self.isUsingDockerMachine = True \
            if hasattr(Version, 'isUsingDockerMachine') and Version.isUsingDockerMachine \
            else False

        self.dockerPath = r'"C:\Program Files\Docker Toolbox"' \
            if self.isUsingDockerMachine \
            else r'"C:\Program Files\Boot2Docker for Windows"'

        self.logFolder = './log'
        self.errFolder = './log'
        self._pid = None

    @property
    def containerId(self):
        """Container ID."""
        if not self.__containerId:
            self.getContainerId()

        return self.__containerId

    @property
    def pid(self):
        """Return PID for the latest command."""
        return self._pid

    def getShellinit(self):
        """Get shellinit for setting up initial environment for docker."""
        os.environ['PATH'] += ';%s' % r'"C:\Program Files (x86)\Git\bin"'
        os.environ['PATH'] += ';%s' % self.dockerPath

        if self.isUsingDockerMachine:
            # version 1606 and higher
            process = Popen('docker-machine env', shell=True, stdout=PIPE,
                            stderr=PIPE)
        else:
            # older versions are using boot2docker
            process = Popen('boot2docker shellinit', shell=True, stdout=PIPE,
                            stderr=PIPE)

        err = '\n'.join(process.stderr)
        if err:
            if err.find('Error checking TLS connection: Host is not running') != -1:
                msg = ' Docker machine is not running! Run Oracle VM VirtualBox Manager ' \
                    'as administrator and make sure "default" machine is "running".'
            else:
                msg = ''

            raise IOError('{}\n\t{}'.format(err, msg))

        return tuple(line.replace('$Env:', 'set ')
                     .replace(' = ', '=')
                     .replace('"', '').strip()
                     for line in process.stdout
                     if not line.startswith('REM'))

    def getContainerId(self):
        """Get OpenFOAM's container id."""
        _id = None
        if not self.shellinit:
            self.shellinit = self.getShellinit()

        cmds = '&'.join(self.shellinit + ('docker ps',))

        p = Popen(cmds, shell=True, stdout=PIPE, stderr=PIPE)

        if tuple(p.stderr):
            for line in p.stderr:
                print(line)
            return

        for count, line in enumerate(p.stdout):
            if line.find('of_plus') > -1:
                # find container
                _id = line.split()[0]
                print('container id: {}'.format(_id))

        self.__containerId = _id

    def getPid(self, command, timeout=5):
        """Get pid of a command."""
        if not self.containerId:
            self.getContainerId()

        self._pid = None
        cmd = 'docker exec -i {} pgrep {}'.format(self.containerId, command)
        cmds = '&'.join(self.shellinit + (cmd,))
        sys.stdout.flush()
        timeout_start = time.time()
        while time.time() < timeout_start + timeout:
            pids = Popen(cmds, shell=True, stdout=PIPE)
            pp = [int(p) for p in tuple(pids.stdout)]
            pp.sort()
            if pp:
                self._pid = int(pp[-1])
                sys.stdout.flush()
                return self._pid
            else:
                time.sleep(0.5)
        sys.stdout.flush()

    def terminate(self, pid=None, force=False):
        """Kill the command using the pid."""
        if not self.containerId:
            self.getContainerId()
        pid = pid or self.pid
        if not pid:
            return
        if force:
            killer = 'docker exec -i {} kill -9 {}'.format(self.containerId, pid)
        else:
            killer = 'docker exec -i {} kill {}'.format(self.containerId, pid)

        cmds = '&'.join(self.shellinit + (killer,))
        sys.stdout.flush()
        k = Popen(cmds, shell=True, stdout=PIPE)
        print(''.join(tuple(k.stdout)))

    @property
    def __ofBatchFile(self):
        if Version.OFFullVer == 'v3.0+':
            return r'C:\Program Files (x86)\ESI\OpenFOAM\v3.0+\Windows\Scripts' \
                '\start_OF.bat'
        else:
            return r'C:\Program Files (x86)\ESI\OpenFOAM\{}\\' \
                'Windows\Scripts\start_OF.bat'.format(Version.OFFullVer[1:-1])

    def startOpenFOAM(self):
        """Start OpenFOAM for Windows image from batch file."""
        Popen(self.__ofBatchFile, shell=True)

    def header(self):
        """Get header for batch files."""
        if not self.shellinit:
            self.shellinit = self.getShellinit()

        _base = '@echo off{0}' \
                'cd {1}{0}' \
                'echo Setting up the environment to connect to docker...{0}' \
                'echo .{0}' \
                '{2}{0}' \
                'echo Done!{0}' \
                'echo Running OpenFOAM commands...{0}' \
                'echo .'

        return _base.format(self.__separator, self.dockerPath,
                            self.__separator.join(self.shellinit))

    # TODO(): Update controlDict.application for multiple commands
    def command(self, cmd, args=None, decomposeParDict=None, includeHeader=True):
        """Get command line for an OpenFOAM command in parallel or serial.

        Args:
            cmd: An OpenFOAM command.
            args: List of optional arguments for command. e.g. ('c', 'latestTime')
            decomposeParDict: decomposeParDict for parallel runs (default: None).
            includeHeader: Include header lines to set up the environment
                (default: True).
            tee: Include tee in command line.
        Returns:
            (cmd, logfiles, errorfiles)
        """
        if isinstance(cmd, str):
            return self.__command(cmd, args, decomposeParDict, includeHeader)
        elif isinstance(cmd, (list, tuple)):
            # a list of commands
            res = namedtuple('log', 'cmd logfiles errorfiles')
            logs = range(len(cmd))  # create a place holder for commands
            for count, c in enumerate(cmd):
                if count > 0:
                    includeHeader = False
                if c == 'blockMesh':
                    decomposeParDict = None
                try:
                    arg = args[count]
                except TypeError:
                    arg = args

                logs[count] = self.__command(c, (arg,), decomposeParDict,
                                             includeHeader)

            command = '&'.join(log.cmd for log in logs)
            logfiles = tuple(ff for log in logs for ff in log.logfiles)
            errorfiles = tuple(ff for log in logs for ff in log.errorfiles)

            return res(command, logfiles, errorfiles)

    def __command(self, cmd, args=None, decomposeParDict=None, includeHeader=True):
        """Get command line for an OpenFOAM command in parallel or serial.

        Args:
            cmd: An OpenFOAM command.
            args: List of optional arguments for command. e.g. ('-c', '-latestTime')
            decomposeParDict: decomposeParDict for parallel runs (default: None).
            includeHeader: Include header lines to set up the environment
                (default: True).
            tee: Include tee in command line.
        Returns:
            (cmd, logfiles, errorfiles)
        """
        tee = 'tee'
        res = namedtuple('log', 'cmd logfiles errorfiles')
        _msg = 'Failed to find container id.' \
            'Do you have the OpenFOAM container running?\n' \
            'You can initiate OpenFOAM container by running start_OF.bat:\n{}' \
            .format(self.__ofBatchFile)

        # try to get containerId
        if not self.containerId:
            self.getContainerId()

        assert self.containerId, _msg

        # containerId is found. put the commands together
        _base = 'start /wait docker exec -i {} su - ofuser -c ' \
            '"cd /home/ofuser/workingDir/butterfly/{}; {}"'
        _baseCmd = '{0} {1} > >(%s %s/{2}.log) 2> >(%s %s/{2}.err >&2)' \
            % (tee, self.logFolder, tee, self.errFolder)

        # join arguments for the command
        arguments = '' if not args else '{}'.format(' '.join(args))

        if decomposeParDict:
            # run in parallel
            n = decomposeParDict.numberOfSubdomains
            arguments = arguments + ' -parallel'

            if cmd == 'snappyHexMesh':
                cmdList = ('decomposePar', 'mpirun -np %s %s' % (n, cmd),
                           'reconstructParMesh', 'rm')
                argList = ('', arguments, '-constant', '-r proc*')
                cmdNameList = ('decomposePar', cmd, 'reconstructParMesh', 'rm')
            else:
                cmdList = ('decomposePar', 'mpirun -np %s %s' % (n, cmd),
                           'reconstructPar', 'rm')
                argList = ('', arguments, '', '-r proc*')
                cmdNameList = ('decomposePar', cmd, 'reconstructPar', 'rm')

            # join commands together
            cmds = (_baseCmd.format(c, arg, name) for c, arg, name in
                    zip(cmdList, argList, cmdNameList))

            cmds = _base.format(self.containerId, self.__projectName,
                                '; '.join(cmds))

            errfiles = tuple('{}/{}.err'.format(self.errFolder, name)
                             for name in cmdNameList)
            logfiles = tuple('{}/{}.log'.format(self.logFolder, name)
                             for name in cmdNameList)
        else:
            # run is serial
            cmds = _base.format(self.containerId, self.__projectName,
                                _baseCmd.format(cmd, arguments, cmd))
            errfiles = ('{}/{}.err'.format(self.errFolder, cmd),)
            logfiles = ('{}/{}.log'.format(self.logFolder, cmd),)

        if includeHeader:
            return res(self.header() + self.__separator + cmds, logfiles, errfiles)
        else:
            return res(cmds, logfiles, errfiles)

    def run(self, command, args=None, decomposeParDict=None, wait=True):
        """Run OpenFOAM command."""
        # get the command as a single line
        cmd, logfiles, errfiles = self.command(command, args, decomposeParDict)

        # run the command.
        # shell should be True to run multiple commands at the same time.
        log = namedtuple('log', 'process logfiles errorfiles')
        p = Popen(cmd, shell=True)
        c = command.split()[0].strip()
        if c in ('blockMesh', 'surfaceFeatureExtract', 'postProcess'):
            timeout = 1
        else:
            timeout = 5
        time.sleep(0.5)  # wait 0.5 second to make sure the command has started
        ppid = self.getPid(command.split()[0], timeout)
        print('Butterfly is running {}. PID: {}'.format(command, ppid))
        if wait:
            p.communicate()
            # once over try to kill the process if exist.
            # This will ensure that the command will be terminated even if the
            # user has canceled the run by closing the batch window.
            self.terminate(ppid)

        return log(p, logfiles, errfiles)

    def checkFileContents(self, files, mute=False):
        """Check files for content and print them out if any.

        args:
            files: A list of ASCII files.

        returns:
            (hasContent, content)
            hasContent: A boolean that shows if there is any contents.
            content: Files content if any
        """
        def readFile(f):
            try:
                with open(f, 'rb') as log:
                    return log.read().strip()
            except Exception as e:
                err = 'Failed to read {}:\n\t{}'.format(f, e)
                print(err)
                return ''

        _lines = '\n'.join(tuple(readFile(f) for f in files)).strip()

        if len(_lines) > 0:
            if not mute:
                print(_lines)
            return True, _lines
        else:
            return False, _lines

    def duplicate(self):
        """Return a copy of this object."""
        return deepcopy(self)

    def ToString(self):
        """Overwrite .NET ToString method."""
        return self.__repr__()

    def __repr__(self):
        """Run manager representation."""
        return """RunManager::{}""".format(self.__projectName)
</code></pre>
  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="butterfly.runmanager.PIPE" class="name">var <span class="ident">PIPE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="butterfly.runmanager.RunManager" class="name">class <span class="ident">RunManager</span></p>
      
  
    <div class="desc"><p>RunManager to write and run OpenFOAM commands through batch files.</p>
<p>Run manager is currently only useful for running OpenFOAM for Windows which
runs in a docker container. For linux systems simply use .bash files or
libraries such as pyFOAM.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager" class="source">
    <pre><code>class RunManager(object):
    """RunManager to write and run OpenFOAM commands through batch files.

    Run manager is currently only useful for running OpenFOAM for Windows which
    runs in a docker container. For linux systems simply use .bash files or
    libraries such as pyFOAM.

    """

    shellinit = None
    __containerId = None

    def __init__(self, projectName):
        u"""Init run manager for project.

        Project path will be set to: C:/Users/%USERNAME%/butterfly/projectName

        Args:
            projectName: A string for project name.
        """
        assert os.name == 'nt', "Currently RunManager is only supported on Windows."
        # make sure user has admin rights
        if not ctypes.windll.shell32.IsUserAnAdmin():
            raise UserNotAdminError(
                'In order to run OpenFOAM using butterfly you must use an admin '
                'account or run the program as administrator.')

        self.__projectName = projectName
        self.__separator = '&'
        self.isUsingDockerMachine = True \
            if hasattr(Version, 'isUsingDockerMachine') and Version.isUsingDockerMachine \
            else False

        self.dockerPath = r'"C:\Program Files\Docker Toolbox"' \
            if self.isUsingDockerMachine \
            else r'"C:\Program Files\Boot2Docker for Windows"'

        self.logFolder = './log'
        self.errFolder = './log'
        self._pid = None

    @property
    def containerId(self):
        """Container ID."""
        if not self.__containerId:
            self.getContainerId()

        return self.__containerId

    @property
    def pid(self):
        """Return PID for the latest command."""
        return self._pid

    def getShellinit(self):
        """Get shellinit for setting up initial environment for docker."""
        os.environ['PATH'] += ';%s' % r'"C:\Program Files (x86)\Git\bin"'
        os.environ['PATH'] += ';%s' % self.dockerPath

        if self.isUsingDockerMachine:
            # version 1606 and higher
            process = Popen('docker-machine env', shell=True, stdout=PIPE,
                            stderr=PIPE)
        else:
            # older versions are using boot2docker
            process = Popen('boot2docker shellinit', shell=True, stdout=PIPE,
                            stderr=PIPE)

        err = '\n'.join(process.stderr)
        if err:
            if err.find('Error checking TLS connection: Host is not running') != -1:
                msg = ' Docker machine is not running! Run Oracle VM VirtualBox Manager ' \
                    'as administrator and make sure "default" machine is "running".'
            else:
                msg = ''

            raise IOError('{}\n\t{}'.format(err, msg))

        return tuple(line.replace('$Env:', 'set ')
                     .replace(' = ', '=')
                     .replace('"', '').strip()
                     for line in process.stdout
                     if not line.startswith('REM'))

    def getContainerId(self):
        """Get OpenFOAM's container id."""
        _id = None
        if not self.shellinit:
            self.shellinit = self.getShellinit()

        cmds = '&'.join(self.shellinit + ('docker ps',))

        p = Popen(cmds, shell=True, stdout=PIPE, stderr=PIPE)

        if tuple(p.stderr):
            for line in p.stderr:
                print(line)
            return

        for count, line in enumerate(p.stdout):
            if line.find('of_plus') > -1:
                # find container
                _id = line.split()[0]
                print('container id: {}'.format(_id))

        self.__containerId = _id

    def getPid(self, command, timeout=5):
        """Get pid of a command."""
        if not self.containerId:
            self.getContainerId()

        self._pid = None
        cmd = 'docker exec -i {} pgrep {}'.format(self.containerId, command)
        cmds = '&'.join(self.shellinit + (cmd,))
        sys.stdout.flush()
        timeout_start = time.time()
        while time.time() < timeout_start + timeout:
            pids = Popen(cmds, shell=True, stdout=PIPE)
            pp = [int(p) for p in tuple(pids.stdout)]
            pp.sort()
            if pp:
                self._pid = int(pp[-1])
                sys.stdout.flush()
                return self._pid
            else:
                time.sleep(0.5)
        sys.stdout.flush()

    def terminate(self, pid=None, force=False):
        """Kill the command using the pid."""
        if not self.containerId:
            self.getContainerId()
        pid = pid or self.pid
        if not pid:
            return
        if force:
            killer = 'docker exec -i {} kill -9 {}'.format(self.containerId, pid)
        else:
            killer = 'docker exec -i {} kill {}'.format(self.containerId, pid)

        cmds = '&'.join(self.shellinit + (killer,))
        sys.stdout.flush()
        k = Popen(cmds, shell=True, stdout=PIPE)
        print(''.join(tuple(k.stdout)))

    @property
    def __ofBatchFile(self):
        if Version.OFFullVer == 'v3.0+':
            return r'C:\Program Files (x86)\ESI\OpenFOAM\v3.0+\Windows\Scripts' \
                '\start_OF.bat'
        else:
            return r'C:\Program Files (x86)\ESI\OpenFOAM\{}\\' \
                'Windows\Scripts\start_OF.bat'.format(Version.OFFullVer[1:-1])

    def startOpenFOAM(self):
        """Start OpenFOAM for Windows image from batch file."""
        Popen(self.__ofBatchFile, shell=True)

    def header(self):
        """Get header for batch files."""
        if not self.shellinit:
            self.shellinit = self.getShellinit()

        _base = '@echo off{0}' \
                'cd {1}{0}' \
                'echo Setting up the environment to connect to docker...{0}' \
                'echo .{0}' \
                '{2}{0}' \
                'echo Done!{0}' \
                'echo Running OpenFOAM commands...{0}' \
                'echo .'

        return _base.format(self.__separator, self.dockerPath,
                            self.__separator.join(self.shellinit))

    # TODO(): Update controlDict.application for multiple commands
    def command(self, cmd, args=None, decomposeParDict=None, includeHeader=True):
        """Get command line for an OpenFOAM command in parallel or serial.

        Args:
            cmd: An OpenFOAM command.
            args: List of optional arguments for command. e.g. ('c', 'latestTime')
            decomposeParDict: decomposeParDict for parallel runs (default: None).
            includeHeader: Include header lines to set up the environment
                (default: True).
            tee: Include tee in command line.
        Returns:
            (cmd, logfiles, errorfiles)
        """
        if isinstance(cmd, str):
            return self.__command(cmd, args, decomposeParDict, includeHeader)
        elif isinstance(cmd, (list, tuple)):
            # a list of commands
            res = namedtuple('log', 'cmd logfiles errorfiles')
            logs = range(len(cmd))  # create a place holder for commands
            for count, c in enumerate(cmd):
                if count > 0:
                    includeHeader = False
                if c == 'blockMesh':
                    decomposeParDict = None
                try:
                    arg = args[count]
                except TypeError:
                    arg = args

                logs[count] = self.__command(c, (arg,), decomposeParDict,
                                             includeHeader)

            command = '&'.join(log.cmd for log in logs)
            logfiles = tuple(ff for log in logs for ff in log.logfiles)
            errorfiles = tuple(ff for log in logs for ff in log.errorfiles)

            return res(command, logfiles, errorfiles)

    def __command(self, cmd, args=None, decomposeParDict=None, includeHeader=True):
        """Get command line for an OpenFOAM command in parallel or serial.

        Args:
            cmd: An OpenFOAM command.
            args: List of optional arguments for command. e.g. ('-c', '-latestTime')
            decomposeParDict: decomposeParDict for parallel runs (default: None).
            includeHeader: Include header lines to set up the environment
                (default: True).
            tee: Include tee in command line.
        Returns:
            (cmd, logfiles, errorfiles)
        """
        tee = 'tee'
        res = namedtuple('log', 'cmd logfiles errorfiles')
        _msg = 'Failed to find container id.' \
            'Do you have the OpenFOAM container running?\n' \
            'You can initiate OpenFOAM container by running start_OF.bat:\n{}' \
            .format(self.__ofBatchFile)

        # try to get containerId
        if not self.containerId:
            self.getContainerId()

        assert self.containerId, _msg

        # containerId is found. put the commands together
        _base = 'start /wait docker exec -i {} su - ofuser -c ' \
            '"cd /home/ofuser/workingDir/butterfly/{}; {}"'
        _baseCmd = '{0} {1} > >(%s %s/{2}.log) 2> >(%s %s/{2}.err >&2)' \
            % (tee, self.logFolder, tee, self.errFolder)

        # join arguments for the command
        arguments = '' if not args else '{}'.format(' '.join(args))

        if decomposeParDict:
            # run in parallel
            n = decomposeParDict.numberOfSubdomains
            arguments = arguments + ' -parallel'

            if cmd == 'snappyHexMesh':
                cmdList = ('decomposePar', 'mpirun -np %s %s' % (n, cmd),
                           'reconstructParMesh', 'rm')
                argList = ('', arguments, '-constant', '-r proc*')
                cmdNameList = ('decomposePar', cmd, 'reconstructParMesh', 'rm')
            else:
                cmdList = ('decomposePar', 'mpirun -np %s %s' % (n, cmd),
                           'reconstructPar', 'rm')
                argList = ('', arguments, '', '-r proc*')
                cmdNameList = ('decomposePar', cmd, 'reconstructPar', 'rm')

            # join commands together
            cmds = (_baseCmd.format(c, arg, name) for c, arg, name in
                    zip(cmdList, argList, cmdNameList))

            cmds = _base.format(self.containerId, self.__projectName,
                                '; '.join(cmds))

            errfiles = tuple('{}/{}.err'.format(self.errFolder, name)
                             for name in cmdNameList)
            logfiles = tuple('{}/{}.log'.format(self.logFolder, name)
                             for name in cmdNameList)
        else:
            # run is serial
            cmds = _base.format(self.containerId, self.__projectName,
                                _baseCmd.format(cmd, arguments, cmd))
            errfiles = ('{}/{}.err'.format(self.errFolder, cmd),)
            logfiles = ('{}/{}.log'.format(self.logFolder, cmd),)

        if includeHeader:
            return res(self.header() + self.__separator + cmds, logfiles, errfiles)
        else:
            return res(cmds, logfiles, errfiles)

    def run(self, command, args=None, decomposeParDict=None, wait=True):
        """Run OpenFOAM command."""
        # get the command as a single line
        cmd, logfiles, errfiles = self.command(command, args, decomposeParDict)

        # run the command.
        # shell should be True to run multiple commands at the same time.
        log = namedtuple('log', 'process logfiles errorfiles')
        p = Popen(cmd, shell=True)
        c = command.split()[0].strip()
        if c in ('blockMesh', 'surfaceFeatureExtract', 'postProcess'):
            timeout = 1
        else:
            timeout = 5
        time.sleep(0.5)  # wait 0.5 second to make sure the command has started
        ppid = self.getPid(command.split()[0], timeout)
        print('Butterfly is running {}. PID: {}'.format(command, ppid))
        if wait:
            p.communicate()
            # once over try to kill the process if exist.
            # This will ensure that the command will be terminated even if the
            # user has canceled the run by closing the batch window.
            self.terminate(ppid)

        return log(p, logfiles, errfiles)

    def checkFileContents(self, files, mute=False):
        """Check files for content and print them out if any.

        args:
            files: A list of ASCII files.

        returns:
            (hasContent, content)
            hasContent: A boolean that shows if there is any contents.
            content: Files content if any
        """
        def readFile(f):
            try:
                with open(f, 'rb') as log:
                    return log.read().strip()
            except Exception as e:
                err = 'Failed to read {}:\n\t{}'.format(f, e)
                print(err)
                return ''

        _lines = '\n'.join(tuple(readFile(f) for f in files)).strip()

        if len(_lines) > 0:
            if not mute:
                print(_lines)
            return True, _lines
        else:
            return False, _lines

    def duplicate(self):
        """Return a copy of this object."""
        return deepcopy(self)

    def ToString(self):
        """Overwrite .NET ToString method."""
        return self.__repr__()

    def __repr__(self):
        """Run manager representation."""
        return """RunManager::{}""".format(self.__projectName)
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#butterfly.runmanager.RunManager">RunManager</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="butterfly.runmanager.RunManager.shellinit" class="name">var <span class="ident">shellinit</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="butterfly.runmanager.RunManager.containerId" class="name">var <span class="ident">containerId</span></p>
            

            
  
    <div class="desc"><p>Container ID.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="butterfly.runmanager.RunManager.dockerPath" class="name">var <span class="ident">dockerPath</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="butterfly.runmanager.RunManager.errFolder" class="name">var <span class="ident">errFolder</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="butterfly.runmanager.RunManager.isUsingDockerMachine" class="name">var <span class="ident">isUsingDockerMachine</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="butterfly.runmanager.RunManager.logFolder" class="name">var <span class="ident">logFolder</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="butterfly.runmanager.RunManager.pid" class="name">var <span class="ident">pid</span></p>
            

            
  
    <div class="desc"><p>Return PID for the latest command.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, projectName)</p>
    </div>
    

    
  
    <div class="desc"><p>Init run manager for project.</p>
<p>Project path will be set to: C:/Users/%USERNAME%/butterfly/projectName</p>
<p>Args:
    projectName: A string for project name.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.__init__', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.__init__" class="source">
    <pre><code>def __init__(self, projectName):
    u"""Init run manager for project.
    Project path will be set to: C:/Users/%USERNAME%/butterfly/projectName
    Args:
        projectName: A string for project name.
    """
    assert os.name == 'nt', "Currently RunManager is only supported on Windows."
    # make sure user has admin rights
    if not ctypes.windll.shell32.IsUserAnAdmin():
        raise UserNotAdminError(
            'In order to run OpenFOAM using butterfly you must use an admin '
            'account or run the program as administrator.')
    self.__projectName = projectName
    self.__separator = '&'
    self.isUsingDockerMachine = True \
        if hasattr(Version, 'isUsingDockerMachine') and Version.isUsingDockerMachine \
        else False
    self.dockerPath = r'"C:\Program Files\Docker Toolbox"' \
        if self.isUsingDockerMachine \
        else r'"C:\Program Files\Boot2Docker for Windows"'
    self.logFolder = './log'
    self.errFolder = './log'
    self._pid = None
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.ToString">
    <p>def <span class="ident">ToString</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Overwrite .NET ToString method.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.ToString', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.ToString" class="source">
    <pre><code>def ToString(self):
    """Overwrite .NET ToString method."""
    return self.__repr__()
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.checkFileContents">
    <p>def <span class="ident">checkFileContents</span>(</p><p>self, files, mute=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Check files for content and print them out if any.</p>
<p>args:
    files: A list of ASCII files.</p>
<p>returns:
    (hasContent, content)
    hasContent: A boolean that shows if there is any contents.
    content: Files content if any</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.checkFileContents', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.checkFileContents" class="source">
    <pre><code>def checkFileContents(self, files, mute=False):
    """Check files for content and print them out if any.
    args:
        files: A list of ASCII files.
    returns:
        (hasContent, content)
        hasContent: A boolean that shows if there is any contents.
        content: Files content if any
    """
    def readFile(f):
        try:
            with open(f, 'rb') as log:
                return log.read().strip()
        except Exception as e:
            err = 'Failed to read {}:\n\t{}'.format(f, e)
            print(err)
            return ''
    _lines = '\n'.join(tuple(readFile(f) for f in files)).strip()
    if len(_lines) > 0:
        if not mute:
            print(_lines)
        return True, _lines
    else:
        return False, _lines
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.command">
    <p>def <span class="ident">command</span>(</p><p>self, cmd, args=None, decomposeParDict=None, includeHeader=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get command line for an OpenFOAM command in parallel or serial.</p>
<p>Args:
    cmd: An OpenFOAM command.
    args: List of optional arguments for command. e.g. ('c', 'latestTime')
    decomposeParDict: decomposeParDict for parallel runs (default: None).
    includeHeader: Include header lines to set up the environment
        (default: True).
    tee: Include tee in command line.
Returns:
    (cmd, logfiles, errorfiles)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.command', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.command" class="source">
    <pre><code>def command(self, cmd, args=None, decomposeParDict=None, includeHeader=True):
    """Get command line for an OpenFOAM command in parallel or serial.
    Args:
        cmd: An OpenFOAM command.
        args: List of optional arguments for command. e.g. ('c', 'latestTime')
        decomposeParDict: decomposeParDict for parallel runs (default: None).
        includeHeader: Include header lines to set up the environment
            (default: True).
        tee: Include tee in command line.
    Returns:
        (cmd, logfiles, errorfiles)
    """
    if isinstance(cmd, str):
        return self.__command(cmd, args, decomposeParDict, includeHeader)
    elif isinstance(cmd, (list, tuple)):
        # a list of commands
        res = namedtuple('log', 'cmd logfiles errorfiles')
        logs = range(len(cmd))  # create a place holder for commands
        for count, c in enumerate(cmd):
            if count > 0:
                includeHeader = False
            if c == 'blockMesh':
                decomposeParDict = None
            try:
                arg = args[count]
            except TypeError:
                arg = args
            logs[count] = self.__command(c, (arg,), decomposeParDict,
                                         includeHeader)
        command = '&'.join(log.cmd for log in logs)
        logfiles = tuple(ff for log in logs for ff in log.logfiles)
        errorfiles = tuple(ff for log in logs for ff in log.errorfiles)
        return res(command, logfiles, errorfiles)
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.duplicate">
    <p>def <span class="ident">duplicate</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a copy of this object.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.duplicate', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.duplicate" class="source">
    <pre><code>def duplicate(self):
    """Return a copy of this object."""
    return deepcopy(self)
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.getContainerId">
    <p>def <span class="ident">getContainerId</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get OpenFOAM's container id.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.getContainerId', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.getContainerId" class="source">
    <pre><code>def getContainerId(self):
    """Get OpenFOAM's container id."""
    _id = None
    if not self.shellinit:
        self.shellinit = self.getShellinit()
    cmds = '&'.join(self.shellinit + ('docker ps',))
    p = Popen(cmds, shell=True, stdout=PIPE, stderr=PIPE)
    if tuple(p.stderr):
        for line in p.stderr:
            print(line)
        return
    for count, line in enumerate(p.stdout):
        if line.find('of_plus') > -1:
            # find container
            _id = line.split()[0]
            print('container id: {}'.format(_id))
    self.__containerId = _id
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.getPid">
    <p>def <span class="ident">getPid</span>(</p><p>self, command, timeout=5)</p>
    </div>
    

    
  
    <div class="desc"><p>Get pid of a command.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.getPid', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.getPid" class="source">
    <pre><code>def getPid(self, command, timeout=5):
    """Get pid of a command."""
    if not self.containerId:
        self.getContainerId()
    self._pid = None
    cmd = 'docker exec -i {} pgrep {}'.format(self.containerId, command)
    cmds = '&'.join(self.shellinit + (cmd,))
    sys.stdout.flush()
    timeout_start = time.time()
    while time.time() < timeout_start + timeout:
        pids = Popen(cmds, shell=True, stdout=PIPE)
        pp = [int(p) for p in tuple(pids.stdout)]
        pp.sort()
        if pp:
            self._pid = int(pp[-1])
            sys.stdout.flush()
            return self._pid
        else:
            time.sleep(0.5)
    sys.stdout.flush()
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.getShellinit">
    <p>def <span class="ident">getShellinit</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get shellinit for setting up initial environment for docker.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.getShellinit', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.getShellinit" class="source">
    <pre><code>def getShellinit(self):
    """Get shellinit for setting up initial environment for docker."""
    os.environ['PATH'] += ';%s' % r'"C:\Program Files (x86)\Git\bin"'
    os.environ['PATH'] += ';%s' % self.dockerPath
    if self.isUsingDockerMachine:
        # version 1606 and higher
        process = Popen('docker-machine env', shell=True, stdout=PIPE,
                        stderr=PIPE)
    else:
        # older versions are using boot2docker
        process = Popen('boot2docker shellinit', shell=True, stdout=PIPE,
                        stderr=PIPE)
    err = '\n'.join(process.stderr)
    if err:
        if err.find('Error checking TLS connection: Host is not running') != -1:
            msg = ' Docker machine is not running! Run Oracle VM VirtualBox Manager ' \
                'as administrator and make sure "default" machine is "running".'
        else:
            msg = ''
        raise IOError('{}\n\t{}'.format(err, msg))
    return tuple(line.replace('$Env:', 'set ')
                 .replace(' = ', '=')
                 .replace('"', '').strip()
                 for line in process.stdout
                 if not line.startswith('REM'))
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.header">
    <p>def <span class="ident">header</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get header for batch files.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.header', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.header" class="source">
    <pre><code>def header(self):
    """Get header for batch files."""
    if not self.shellinit:
        self.shellinit = self.getShellinit()
    _base = '@echo off{0}' \
            'cd {1}{0}' \
            'echo Setting up the environment to connect to docker...{0}' \
            'echo .{0}' \
            '{2}{0}' \
            'echo Done!{0}' \
            'echo Running OpenFOAM commands...{0}' \
            'echo .'
    return _base.format(self.__separator, self.dockerPath,
                        self.__separator.join(self.shellinit))
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.run">
    <p>def <span class="ident">run</span>(</p><p>self, command, args=None, decomposeParDict=None, wait=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Run OpenFOAM command.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.run', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.run" class="source">
    <pre><code>def run(self, command, args=None, decomposeParDict=None, wait=True):
    """Run OpenFOAM command."""
    # get the command as a single line
    cmd, logfiles, errfiles = self.command(command, args, decomposeParDict)
    # run the command.
    # shell should be True to run multiple commands at the same time.
    log = namedtuple('log', 'process logfiles errorfiles')
    p = Popen(cmd, shell=True)
    c = command.split()[0].strip()
    if c in ('blockMesh', 'surfaceFeatureExtract', 'postProcess'):
        timeout = 1
    else:
        timeout = 5
    time.sleep(0.5)  # wait 0.5 second to make sure the command has started
    ppid = self.getPid(command.split()[0], timeout)
    print('Butterfly is running {}. PID: {}'.format(command, ppid))
    if wait:
        p.communicate()
        # once over try to kill the process if exist.
        # This will ensure that the command will be terminated even if the
        # user has canceled the run by closing the batch window.
        self.terminate(ppid)
    return log(p, logfiles, errfiles)
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.startOpenFOAM">
    <p>def <span class="ident">startOpenFOAM</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Start OpenFOAM for Windows image from batch file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.startOpenFOAM', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.startOpenFOAM" class="source">
    <pre><code>def startOpenFOAM(self):
    """Start OpenFOAM for Windows image from batch file."""
    Popen(self.__ofBatchFile, shell=True)
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="butterfly.runmanager.RunManager.terminate">
    <p>def <span class="ident">terminate</span>(</p><p>self, pid=None, force=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Kill the command using the pid.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.RunManager.terminate', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.RunManager.terminate" class="source">
    <pre><code>def terminate(self, pid=None, force=False):
    """Kill the command using the pid."""
    if not self.containerId:
        self.getContainerId()
    pid = pid or self.pid
    if not pid:
        return
    if force:
        killer = 'docker exec -i {} kill -9 {}'.format(self.containerId, pid)
    else:
        killer = 'docker exec -i {} kill {}'.format(self.containerId, pid)
    cmds = '&'.join(self.shellinit + (killer,))
    sys.stdout.flush()
    k = Popen(cmds, shell=True, stdout=PIPE)
    print(''.join(tuple(k.stdout)))
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="butterfly.runmanager.UserNotAdminError" class="name">class <span class="ident">UserNotAdminError</span></p>
      
  
    <div class="desc"><p>Exception for non-admin users.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-butterfly.runmanager.UserNotAdminError', this);">Show source &equiv;</a></p>
  <div id="source-butterfly.runmanager.UserNotAdminError" class="source">
    <pre><code>class UserNotAdminError(Exception):
    """Exception for non-admin users."""
    pass
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#butterfly.runmanager.UserNotAdminError">UserNotAdminError</a></li>
          <li>exceptions.Exception</li>
          <li>exceptions.BaseException</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="butterfly.runmanager.UserNotAdminError.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="butterfly.runmanager.UserNotAdminError.message" class="name">var <span class="ident">message</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a>
    </p>
  </footer>
</div>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
